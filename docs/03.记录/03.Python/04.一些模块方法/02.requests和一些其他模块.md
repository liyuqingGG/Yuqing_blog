---
title: requests-和一些其他模块
date: 2022-02-22 11:30:38
permalink: /pages/51754f/
categories:
  - 记录
  - Python
  - 一些模块方法
tags:
  - 
titleTag: 原创
---
 requests使用
1. pip install requests
2. import requests


## requests 简单请求
```python
import requests
url = 'https://www.baidu.com' # 百度为例
response = requests.get(url=url)
print(response) # 返回的格式和正常有区别 可以用其他为例 因为是pycharm通过requests发送出去的 请求头为'User-Agent': 'python-requests/2.24.0',百度有鉴别功能会认为是机器人

# 获取响应状态码
print(response.status_code)

# 获取响应头
print(response.headers)

# 获取响应体
# 1.
print(response.text) # 自动识别返回内容进行解码 可能会乱码
# 2.
print(response.content.decode('utf-8')) # 通过decode方法指定编码方式解码
# 3.
print(response.json()) # 只有返回的数据是json才能用 否则会报错 接口测试用 会将返回的json转换为python数据

# 获取请求头
print(response.requests.headers)

# 获取请求提
print(response.requests.body)
```

## 各种content-type对应的参数
```python
import requests
# content-type : application/x-www-form-urlencoded
# 参数类型为表单对应使用data关键字传参
response = requests.post(url=url,data=data)

# content-type : application/json
# 参数类型为json对应使用json关键字传参
response = requests.post(url=url,json=data)

# get请求参数
# 方式一：参数直接拼接在url后，？链接 参数&链接
url = 'http://xxxx.com?param1&param2'
response = requests.get(url=url)

# 方式二：使用params关键字参数传参
url = 'http://xxx.com'
params = {
    'one':'param1',
    'two':'param2'
}
response = requests.get(url=url,params=params)

# content-type : form-data
# 文件上传，关键files传参
response = request.post(url=url,files=file)
```

## 处理cookie+session鉴权
```python
# requests自带session功能函数，直接调用即可
import requests

s = requests.session
```

## jsonpath 提取token 处理token鉴权
1. 取出token
2. 把token传递给下游接口
```python
# 把登录接口返回的token值取出来，传递给下游接口
# 返回数据是json格式可直接通过requests.json()获取数据后通过索引取值
# 也可以用jsonpath取值
from jsonpath import jsonpath
# 1.    $               根节点          jsonpath('数据','jsonpath表达式')
# 2.    .               直接子节点
# 3.    ..              子孙节点
# 4.    []              选择子节点/索引
# 5.    [,]             选择多个字段
# 6.    @               代表当前选中的节点，和过滤条件一起用
# 7.    [?(过滤条件)]    通过条件过滤数据
# 获取到token后通过headers参数传递过去
token = {
    'Authorztion' : 'Bearer' + 'json()中获取的token值' 
}
requests.post(url=url,headers=token,json=param)

```

## pysql 操作数据库
```python
# pip install pymysql
import pymysql

# 1.创建链接
con = pymysql.connect(host='数据库地址',port='端口号',user='数据库用户名','password'='数据密码',charset='utf8')

# 2.创建游标对象
cur = con.cursor()

# 3.游标对象执行sql语句
cur.execute('sql')
# 4.涉及增删改 需提交事务
con.commit()
# 通过with语句解决
with con as c:
  c.execute('sql')
```